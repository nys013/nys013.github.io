(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{602:function(t,a,e){"use strict";e.r(a);var s=e(2),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v("以下几种方式，核心都是拿到code在应用页面实现登录")]),t._v(" "),a("h2",{attrs:{id:"_1-企微内打开登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-企微内打开登录"}},[t._v("#")]),t._v(" 1.企微内打开登录")]),t._v(" "),a("p",[t._v("用户在企业微信APP内打开H5页面、企微桌面端打开页面，实现自动登录，则需构造oauth2链接")]),t._v(" "),a("p",[t._v("文档："),a("a",{attrs:{href:"https://developer.work.weixin.qq.com/document/path/91022",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.work.weixin.qq.com/document/path/91022"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("具体过程：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("构造oauth2网页授权链接，如在企微中配置相应的redirect_uri，则构造出\n"),a("code",[t._v("https://open.weixin.qq.com/connect/oauth2/authorize?appid=CORPID&redirect_uri=REDIRECT_URI&response_type=code&scope=snsapi_base&state=STATE&agentid=AGENTID#wechat_redirect")]),t._v("\n点击应用，企微自动授权后，页面将跳转至redirect_uri?code=CODE，其中redirect_uri为项目地址")])]),t._v(" "),a("li",[a("p",[t._v("跳转项目链接后，query参数中有code，前端拿到code调用后端登录接口，登录成功后跳转首页即可")])])]),t._v(" "),a("h2",{attrs:{id:"_2-外部浏览器打开登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-外部浏览器打开登录"}},[t._v("#")]),t._v(" 2.外部浏览器打开登录")]),t._v(" "),a("p",[t._v("用户在外部浏览器打开页面，希望出现企微登录面板，实现快捷登录。适用于pc端，因为登录面板都是获取的桌面端，或者是出现二维码，所以更适用于pc浏览器场景")]),t._v(" "),a("p",[t._v("文档："),a("a",{attrs:{href:"https://developer.work.weixin.qq.com/document/path/98152",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.work.weixin.qq.com/document/path/98152"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"_2-1-createwwloginpanel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-createwwloginpanel"}},[t._v("#")]),t._v(" 2.1 createWWLoginPanel")]),t._v(" "),a("p",[t._v("使用企业微信 JS-SDK，调用"),a("code",[t._v("createWWLoginPanel")]),t._v("，在应用中创建面板，传入预留好面板出现位置的元素"),a("code",[t._v("wecomRef.value")]),t._v("，然后"),a("code",[t._v("onLoginSuccess")]),t._v("中拿到code调用登录接口即可")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createWWLoginPanel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("el")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" wecomRef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("params")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("login_type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" WWLoginType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("corpApp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      appid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      agentid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("redirect_uri")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("https://")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'loginState'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("redirect_type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" WWLoginRedirectType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("panel_size")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" WWLoginPanelSizeType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("small"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onLoginSuccess")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拿到code调用登录接口")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-2-构造企业微信登录链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-构造企业微信登录链接"}},[t._v("#")]),t._v(" 2.2 构造企业微信登录链接")]),t._v(" "),a("p",[t._v("构造如"),a("code",[t._v("https://login.work.weixin.qq.com/wwlogin/sso/login?login_type=LOGIN_TYPE&appid=APPID&redirect_uri=REDIRECT_URI&state=STATE")]),t._v("链接")]),t._v(" "),a("p",[t._v("然后需要企微登录时打开构造的链接，该链接页面显示企微登录面板，用户授权登录后，同1一样，跳转redirect_uri?code=CODE，拿到code登录即可")]),t._v(" "),a("p",[t._v("同1的区别是：")]),t._v(" "),a("ul",[a("li",[t._v("1是企微应用内打开，构造的是oauth2链接，实现自动登录，pc和移动端都适合")]),t._v(" "),a("li",[t._v("2.2是随便哪个浏览器打开，构造的是企微登录链接，出现登录面板，需用户手动点击登录，更适合pc")])]),t._v(" "),a("Vssue",{staticClass:"theme-default-content content__default"})],1)}),[],!1,null,null,null);a.default=n.exports}}]);